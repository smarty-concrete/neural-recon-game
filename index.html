<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neural Recon Terminal</title>

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Neural Recon">
    <meta name="theme-color" content="#050506">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Neural Recon">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-96.png">

    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="briefingOverlay">
        <div class="briefing-modal">
            <div class="briefing-header">Mission Briefing</div>

            <div class="briefing-tabs">
                <div class="briefing-tab active" data-tab="basics">How to Play</div>
                <div class="briefing-tab" data-tab="tips">Pro Tips</div>
            </div>

            <div id="tab-basics" class="briefing-content active">
                <div class="briefing-section">
                    <h3>Goal</h3>
                    <p>Find the hidden path through the grid by placing the missing walls.</p>
                </div>

                <div class="briefing-section">
                    <h3>Rules</h3>
                    <p>1. The <span class="briefing-tag">numbers</span> on each row/column show how many walls belong there.</p>
                    <p>2. The path must be <span class="briefing-tag">continuous</span> â€” all path nodes and dead ends connect.</p>
                    <p>3. <span class="briefing-tag">No 2Ã—2 squares</span> of path nodes allowed (except inside a data vault).</p>
                    <p>4. On larger grids, a <span class="briefing-tag">Data Stockpile</span> may appear inside a hidden 3Ã—3 vault with a single door.</p>
                </div>

                <div class="briefing-section">
                    <h3>Cell Types</h3>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-wall"></span>
                        <span class="briefing-row-label"><span class="briefing-tag">Wall Node</span> â€” Click once to place. Blocks the path. Fill in all walls to finish the puzzle.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-path"></span>
                        <span class="briefing-row-label"><span class="briefing-tag">Path Node</span> â€” Click twice to place. Marks where the path goes. It is not necessary to fill in all paths to finish the puzzle.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-deadend"></span>
                        <span class="briefing-row-label"><span class="briefing-tag">Dead End Node</span> â€” Fixed on the grid. The path must connect to each of these. Each dead end node must connect to exactly one path.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-stockpile"></span>
                        <span class="briefing-row-label"><span class="briefing-tag">Data Stockpile</span> â€” Located inside a 3Ã—3 vault surrounded by walls with one door. Turns green when the vault is properly sealed.</span>
                    </div>
                </div>
                
                <div class="briefing-section">
                    <h3>Controls</h3>
                    <p>Use the <span class="briefing-tag">Mode</span> buttons to select what to draw:</p>
                    <p><span class="briefing-tag">Wall</span> â€” Tap to place walls, tap walls to erase</p>
                    <p><span class="briefing-tag">Path</span> â€” Tap to place paths, tap paths to erase</p>
                    <p><span class="briefing-tag">Erase</span> â€” Tap any cell to clear it</p>
                    <p><span class="briefing-tag">Auto</span> â€” Context-aware: tap empty for wall, tap wall for path, tap path to erase. Drag from dead end nodes or data stockpile nodes to draw paths. Tap on dead end nodes to auto-fill walls and paths when able.</p>
                </div>

                <div class="briefing-section">
                    <h3>Layers (Advanced)</h3>
                    <p>Use <span class="briefing-tag">Fork</span> to create a new layer for experimenting.</p>
                    <p>Use <span class="briefing-tag">Commit</span> to merge your changes down, or <span class="briefing-tag">Abort</span> to discard.</p>
                </div>
            </div>

            <div id="tab-tips" class="briefing-content">
                <div class="briefing-section">
                    <h3>Tip 1: Tap Dead Ends with One Path or Three Walls</h3>
                    <p>When a dead end already has one path neighbor, or three wall neighbors, tap it to auto-fill walls and paths around it.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The dead end already connects left. Tapping it fills the other 3 neighbors with walls automatically.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 2: Tap Green Numbers</h3>
                    <p>When a row/column has the correct wall count (green number), tap it to fill remaining cells with path nodes.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div class="tip-label" style="color: var(--neon-green); font-weight: bold;">2</div>
                                <div class="tip-grid" style="grid-template-columns: repeat(4, 24px);">
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-deduced"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-deduced"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            This row needs 2 walls and already has 2. Tap the green "2" to fill empty cells with path nodes.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 3: Use Fork for Guessing</h3>
                    <p>Stuck? Use <span class="briefing-tag">Fork</span> to try a guess. If it leads to a contradiction, <span class="briefing-tag">Abort</span> and try the opposite.</p>
                </div>

                <div class="briefing-section">
                    <h3>Tip 4: Data Vault Layout</h3>
                    <p>On 6Ã—6+ grids, look for a 3Ã—3 vault with 11 walls around it and 1 door. The vault contains a <span class="briefing-tag">Data Stockpile</span> somewhere inside.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-stockpile"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The vault has 11 walls surrounding it with a single door. This example shows the door at the bottom, but it can be in any wall. The 3Ã—3 interior is empty other than the data stockpile cell.
                        </div>
                    </div>
                </div>

                <div class="briefing-section" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #333;">
                    <h3 style="color: var(--neon-magenta);">Expert Tips</h3>
                </div>

                <div class="briefing-section">
                    <h3>Tip 5: Don't Create Unwanted Dead Ends</h3>
                    <p>If a row needs only 1 more wall, it can't be placed where it would trap an empty cell with 3 walls.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: var(--neon-green); width: 16px;">2</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell tip-cell-maybe" style="font-size:10px; color:#f88;">X</div>
                                        <div class="tip-cell" style="font-size:9px; color:#888;">trap</div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: #888; width: 16px;">3</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell tip-cell-maybe"></div>
                                        <div class="tip-cell tip-cell-maybe"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The top row needs only 1 more wall. The wall cannot go at X since that would create a dead end with no dead end node. X must therefore be part of the path. The bottom row still needs 2 more walls, so this technique doesn't apply there.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 6: Avoid 2Ã—2 Path Squares</h3>
                    <p>If placing a path would create a 2Ã—2 square of paths, that cell must be a wall.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            Three corners of a 2Ã—2 are paths. The fourth <em>must</em> be a wall to avoid a 2Ã—2 path square.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 7: Dead End with One Wall Left</h3>
                    <p>If a row needs exactly 1 more wall and has a dead end with no walls on either side, deduce the perpendicular walls and the rest of the row.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="width: 16px;"></div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: #888; width: 16px;">1</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-maybe" style="font-size:9px; color:#fa0;">X</div>
                                        <div class="tip-cell tip-cell-deadend"></div>
                                        <div class="tip-cell tip-cell-maybe" style="font-size:9px; color:#fa0;">X</div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="width: 16px;"></div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            This row needs 1 wall. Since a dead end cell requires 3 walls, the row's only wall must be one of the two cells to the left or right of the dead end cell (X). Even though it cannot be deduced which of the two is the wall and which is part of the path, it is known that the two cells above and below must be walls, and also all other cells in the row are also part of the path.
                        </div>
                    </div>
                </div>
            </div>

            <div class="briefing-footer">
                <button id="closeBriefingBtn" class="cyber-btn" style="padding: 10px 40px; font-size: 14px;">Got It</button>
            </div>
        </div>
    </div>

    <div class="header-strip">
        <button id="soundToggleBtn" class="cyber-btn btn-sound" title="Toggle Sound">
            <span id="soundIcon">ðŸ”Š</span>
        </button>
        <button id="briefingBtn" class="cyber-btn btn-amber">Briefing</button>
        <select id="gridSizeSelect" class="size-select">
            <option value="4">4x4</option>
            <option value="5">5x5</option>
            <option value="6">6x6</option>
            <option value="7">7x7</option>
            <option value="8" selected>8x8</option>
        </select>
        <button id="newMazeBtn" class="cyber-btn">Initialize</button>
        <button id="undoBtn" class="cyber-btn" disabled>Undo</button>
        <div class="btn-group-nowrap">
            <button id="addLayerBtn" class="cyber-btn btn-action">Fork</button>
            <button id="commitBtn" class="cyber-btn">Commit</button>
            <button id="discardBtn" class="cyber-btn btn-kill">Abort</button>
            <div class="layer-indicator">
                <span id="layerName" class="layer-name">Root</span>
            </div>
        </div>
    </div>

    <div class="mode-strip">
        <button id="modeWall" class="mode-btn" data-mode="wall">
            <span class="mode-icon mode-icon-wall"></span>
            <span>Wall</span>
        </button>
        <button id="modePath" class="mode-btn" data-mode="path">
            <span class="mode-icon mode-icon-path"></span>
            <span>Path</span>
        </button>
        <button id="modeErase" class="mode-btn" data-mode="erase">
            <span class="mode-icon mode-icon-erase"></span>
            <span>Erase</span>
        </button>
        <button id="modeSmart" class="mode-btn active" data-mode="smart">
            <span class="mode-icon mode-icon-wall"></span>
            <span class="mode-icon mode-icon-path"></span>
            <span class="mode-icon mode-icon-erase"></span>
            <span>Auto</span>
        </button>
    </div>

    <div class="grid-wrapper">
        <div></div><div id="colLabels" class="label-container-col"></div><div></div>
        <div id="rowLabels" class="label-container-row"></div>
        <div id="mainGrid" class="cyber-grid">
            <div id="victoryOverlay">
                <div class="scan-lines"></div>
                <div class="victory-content">
                    <div class="victory-title">NEURAL LINK RESTORED</div>
                    <div id="technoBabble" class="techno-babble"></div>
                    <div class="victory-stats">
                        <div class="stat-row">
                            <span class="stat-label">Sync Duration:</span>
                            <span id="statTime" class="stat-value">00:00</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Node Operations:</span>
                            <span id="statMoves" class="stat-value">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Consecutive Links:</span>
                            <span id="statStreak" class="stat-value">1</span>
                        </div>
                    </div>
                    <button id="nextLevelBtn" class="cyber-btn btn-action next-level-btn">Initialize Next Sequence</button>
                </div>
            </div>
        </div>
        <div class="grid-spacer"></div>
    </div>

    <div class="decrypt-section">
        <button id="decryptBtn" class="cyber-btn decrypt-btn">Toggle Decrypt Overlay</button>
        <div id="answerKeySection" class="answer-key-section">
            <div id="miniGrid" class="mini-grid"></div>
        </div>
    </div>

    <script src="game.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>

