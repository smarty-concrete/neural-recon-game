<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neural Recon Terminal</title>

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Neural Recon">
    <meta name="theme-color" content="#050506">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Neural Recon">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-96.png">

    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="briefingOverlay">
        <div class="briefing-modal">
            <div class="briefing-header" id="briefingTitle">Mission Briefing</div>

            <div class="briefing-tabs">
                <div class="briefing-tab active" data-tab="basics">How to Play</div>
                <div class="briefing-tab" data-tab="tips">Pro Tips</div>
            </div>

            <div id="tab-basics" class="briefing-content active">
                <div class="briefing-section">
                    <h3>Goal</h3>
                    <p>Find the hidden path through the grid by placing the missing <span class="theme-walls">walls</span>.</p>
                </div>

                <div class="briefing-section">
                    <h3>Rules</h3>
                    <p>1. The <span class="briefing-tag">numbers</span> on each row/column show how many <span class="theme-walls">walls</span> belong there.</p>
                    <p>2. The path must be <span class="briefing-tag">continuous</span>. All path nodes connect.</p>
                    <p>3. <span class="briefing-tag">No 2Ã—2 squares</span> of path nodes allowed (except inside a <span class="theme-vault">vault</span>).</p>
                    <p>4. On larger grids, a <span class="briefing-tag theme-stockpile">Stockpile</span> may appear inside a hidden 3Ã—3 <span class="theme-vault">vault</span> with a single door.</p>
                </div>

                <div class="briefing-section">
                    <h3>Cell Types</h3>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-wall"></span>
                        <span class="briefing-row-label"><span class="briefing-tag theme-wall">Wall</span> â€” Blocks the <span class="theme-path">path</span>. Fill in all <span class="theme-walls">walls</span> to finish the puzzle.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-path"></span>
                        <span class="briefing-row-label"><span class="briefing-tag theme-path">Path</span> â€” Marks where the path goes. It is not necessary to fill in all paths to finish the puzzle.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-deadend"></span>
                        <span class="briefing-row-label"><span class="briefing-tag theme-deadend">Dead End</span> â€” Fixed on the grid. The path must connect to each of these. Each <span class="theme-deadend">dead end</span> must connect to exactly one path node and 3 wall nodes.</span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-stockpile"></span>
                        <span class="briefing-row-label"><span class="briefing-tag theme-stockpile">Stockpile</span> â€” <span id="stockpileDesc">Located inside a 3Ã—3 vault surrounded by walls with one door. Turns green when the vault is properly sealed.</span></span>
                    </div>
                    <div class="briefing-row">
                        <span class="cell-icon cell-icon-locked"></span>
                        <span class="briefing-row-label"><span class="briefing-tag">Lock</span> â€” Like <span class="theme-walls">walls</span>, these block the <span class="theme-path">path</span>. However, these nodes are fixed on the grid and cannot be removed.</span>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Controls</h3>
                    <p>Use the <span class="briefing-tag">Mode</span> buttons to select what to draw:</p>
                    <p><span class="briefing-tag theme-wall">Wall</span> â€” Tap to place <span class="theme-walls">walls</span>, tap <span class="theme-walls">walls</span> to erase</p>
                    <p><span class="briefing-tag theme-path">Path</span> â€” Tap to place <span class="theme-paths">paths</span>, tap <span class="theme-paths">paths</span> to erase</p>
                    <p><span class="briefing-tag">Erase</span> â€” Tap any cell to clear it</p>
                    <p><span class="briefing-tag">Auto</span> â€” Context-aware: tap empty for <span class="theme-wall">wall</span>, tap <span class="theme-wall">wall</span> for path, tap path to erase. Drag from <span class="theme-deadends">dead ends</span> or <span class="theme-stockpile">data caches</span> to draw paths. Tap on <span class="theme-deadends">dead ends</span> to auto-fill <span class="theme-walls">walls</span> and paths when able. Tap on the tool twice for a quick overview.</p>
                </div>

                <div class="briefing-section">
                    <h3>Layers (Advanced)</h3>
                    <p>Use <span class="briefing-tag theme-fork">Fork</span> to create a new layer for experimenting.</p>
                    <p>Use <span class="briefing-tag theme-commit">Commit</span> to merge your changes down, or <span class="briefing-tag theme-discard">Discard</span> to undo.</p>
                </div>
            </div>

            <div id="tab-tips" class="briefing-content">
                <div class="briefing-section">
                    <h3>Tip 1: Tap <span class="theme-deadends">dead ends</span> with One Path or Three <span class="theme-walls">Walls</span></h3>
                    <p>When a <span class="theme-deadend">dead end</span> already has one path neighbor, or three <span class="theme-wall">wall</span> neighbors, tap it to auto-fill <span class="theme-walls">walls</span> and paths around it.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The <span class="theme-deadend">dead end</span> already connects left. Tapping it fills the other 3 neighbors with <span class="theme-walls">walls</span> automatically.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 2: Tap Green Numbers</h3>
                    <p>When a row/column has the correct <span class="theme-wall">wall</span> count (green number), tap it to fill remaining cells with path nodes.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div class="tip-label" style="color: var(--neon-green); font-weight: bold;">2</div>
                                <div class="tip-grid" style="grid-template-columns: repeat(4, 24px);">
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-deduced"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-deduced"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            This row needs 2 <span class="theme-walls">walls</span> and already has 2. Tap the green "2" to fill empty cells with path nodes.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 3: Use <span class="theme-fork">Fork</span> for Guessing</h3>
                    <p>Stuck? Use <span class="briefing-tag theme-fork">Fork</span> to try a guess. If it leads to a contradiction, <span class="briefing-tag theme-discard">Discard</span> and try the opposite.</p>
                </div>

                <div class="briefing-section">
                    <h3>Tip 4: <span class="theme-vault">Vault</span> Layout</h3>
                    <p id="vaultDesc">On {VAULT_SIZE}+ grids, look for a 3Ã—3 vault with 11 walls around it and 1 door. The vault contains a <span class="briefing-tag theme-stockpile">Stockpile</span> somewhere inside.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-stockpile"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The <span class="theme-vault">vault</span> has 11 <span class="theme-walls">walls</span> surrounding it with a single door. This example shows the door at the bottom, but it can be in any <span class="theme-wall">wall</span>. The 3Ã—3 interior is empty other than the <span class="theme-stockpile">stockpile</span> cell.
                        </div>
                    </div>
                </div>

                <div class="briefing-section" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #333;">
                    <h3 style="color: var(--neon-magenta);">Expert Tips</h3>
                </div>

                <div class="briefing-section">
                    <h3>Tip 5: Don't Create Unwanted <span class="theme-deadends">dead ends</span></h3>
                    <p>If a row needs only 1 more <span class="theme-wall">wall</span>, it can't be placed where it would trap an empty cell with 3 <span class="theme-walls">walls</span>.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: var(--neon-green); width: 16px;">2</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell tip-cell-maybe" style="font-size:10px; color:#f88;">X</div>
                                        <div class="tip-cell" style="font-size:9px; color:#888;">trap</div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: #888; width: 16px;">3</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell tip-cell-maybe"></div>
                                        <div class="tip-cell tip-cell-maybe"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The top row needs only 1 more <span class="theme-wall">wall</span>. The <span class="theme-wall">wall</span> cannot go at X since that would create a cell surrounded by 3 walls with no <span class="theme-deadend">dead end</span> node. X must therefore be part of the path. The bottom row still needs 2 more <span class="theme-walls">walls</span>, so this technique doesn't apply there.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 6: Avoid 2Ã—2 Path Squares</h3>
                    <p>If placing a path would create a 2Ã—2 square of paths, that cell must be a <span class="theme-wall">wall</span>.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            Three corners of a 2Ã—2 are paths. The fourth <em>must</em> be a <span class="theme-wall">wall</span> to avoid a 2Ã—2 path square.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 7: <span class="theme-deadend">Dead End</span> with One <span class="theme-wall">Wall</span> Left</h3>
                    <p>If a row needs exactly 1 more <span class="theme-wall">wall</span> and has a <span class="theme-deadend">dead end</span> with no <span class="theme-walls">walls</span> on either side, deduce the perpendicular <span class="theme-walls">walls</span> and the rest of the row.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="width: 16px;"></div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: #888; width: 16px;">1</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-maybe" style="font-size:9px; color:#fa0;">X</div>
                                        <div class="tip-cell tip-cell-deadend"></div>
                                        <div class="tip-cell tip-cell-maybe" style="font-size:9px; color:#fa0;">X</div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="width: 16px;"></div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(5, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            This row needs 1 <span class="theme-wall">wall</span>. Since a <span class="theme-deadend">dead end</span> is surrounded by 3 <span class="theme-walls">walls</span>, the row's only <span class="theme-wall">wall</span> must be one of the two cells to the left or right of the <span class="theme-deadend">dead end</span> (X). Even though it cannot be deduced which of the two is the <span class="theme-wall">wall</span> and which is part of the path, it is known that the two cells above and below must be <span class="theme-walls">walls</span>, and also all other cells in the row are also part of the path.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 8: Path Must Extend</h3>
                    <p>A path cell with 2 <span class="theme-walls">walls</span> around it must extend in both remaining directions.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deduced"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The path cell is surrounded by <span class="theme-walls">walls</span> on 2 sides. It must continue somewhere. The only option is upward, so that cell must be a path.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 9: Corner Flanked by <span class="theme-deadends">Dead Ends</span></h3>
                    <p>A corner cell with <span class="theme-deadends">dead ends</span> on both open sides must be a <span class="theme-wall">wall</span>.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 24px);">
                                <div class="tip-cell tip-cell-deduced tip-cell-wall" style="border-left: 3px solid #666; border-top: 3px solid #666;"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The corner cell is blocked by the grid edge on two sides. The other two neighbors are <span class="theme-deadends">dead ends</span>. A <span class="theme-path">path</span> in the corner would necessitate a pattern of <span class="theme-walls">walls</span> around them that would cut the corner off from the rest of the <span class="theme-path">path</span>. Therefore, the corner must be a <span class="theme-wall">wall</span>.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 10: <span class="theme-vault">Vault</span> Position Constraints</h3>
                    <p>When a <span class="theme-stockpile">Stockpile</span> is near an edge or <span class="theme-walls">walls</span>, some cells must be paths to fit the 3Ã—3 <span class="theme-vault">vault</span>.</p>
                    <div class="tip-example">
                        <div>
                            <div class="tip-grid" style="grid-template-columns: repeat(4, 24px);">
                                <div class="tip-cell" style="border-left: 3px solid #666; border-top: 3px solid #666;"></div>
                                <div class="tip-cell" style="border-top: 3px solid #666;"></div>
                                <div class="tip-cell" style="border-top: 3px solid #666;"></div>
                                <div class="tip-cell" style="border-top: 3px solid #666;"></div>
                                <div class="tip-cell" style="border-left: 3px solid #666;"></div>
                                <div class="tip-cell tip-cell-stockpile"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell" style="border-left: 3px solid #666;"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deduced tip-cell-path"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell" style="border-left: 3px solid #666;"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            The <span class="theme-stockpile">Stockpile</span> is near the top-left corner. The 3Ã—3 <span class="theme-vault">vault</span> could be in various positions while still enclosing the <span class="theme-stockpile">Stockpile</span>. The three cells in the shown positions are a part of the <span class="theme-vault">vault</span> in all possibilities.
                        </div>
                    </div>
                </div>

                <div class="briefing-section">
                    <h3>Tip 11: Row/Column Completion Errors</h3>
                    <p>If completing a row or column with a certain value would propagate to create an error, the opposite must be true.</p>
                    <div class="tip-example">
                        <div>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="color: var(--neon-green); width: 16px;">1</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(4, 24px);">
                                        <div class="tip-cell tip-cell-deduced tip-cell-wall"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-maybe" style="font-size:9px; color:#fa0;">?</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div class="tip-label" style="width: 16px;"></div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(4, 24px);">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tip-explanation">
                            This row needs 1 <span class="theme-wall">wall</span>. If the wall were in the leftmost cell, the rightmost cell (?) would have to be a <span class="theme-path">path</span>, but that would create a 2Ã—2 path block. Therefore, the first cell must be a <span class="theme-path">path</span>.
                        </div>
                    </div>
                </div>
            </div>

            <div class="briefing-footer">
                <label class="briefing-checkbox-label">
                    <input type="checkbox" id="dontShowBriefingCheckbox">
                    <span>Don't show on startup</span>
                </label>
                <button id="closeBriefingBtn" class="cyber-btn" style="padding: 10px 40px; font-size: 14px;">Got It</button>
            </div>
        </div>
    </div>

    <div class="header-strip">
        <button id="menuBtn" class="cyber-btn btn-menu" title="Menu">â˜°</button>
        <select id="gridSizeSelect" class="size-select">
            <option value="4">4x4</option>
            <option value="5">5x5</option>
            <option value="6">6x6</option>
            <option value="7">7x7</option>
            <option value="8" selected>8x8</option>
        </select>
        <button id="newMazeBtn" class="cyber-btn">Initialize</button>
        <button id="undoBtn" class="cyber-btn" disabled>Undo</button>
        <button id="hintBtn" class="cyber-btn btn-hint" title="Get Hint">?</button>
        <div class="btn-group-nowrap">
            <button id="addLayerBtn" class="cyber-btn btn-action">Fork</button>
            <button id="commitBtn" class="cyber-btn">Commit</button>
            <button id="discardBtn" class="cyber-btn btn-kill">Abort</button>
            <div class="layer-indicator">
                <span id="layerName" class="layer-name">Root</span>
            </div>
        </div>
    </div>

    <!-- Slide-in Menu -->
    <div id="menuOverlay" class="menu-overlay">
        <div id="slideMenu" class="slide-menu">
            <div class="menu-header">
                <span class="menu-title">MENU</span>
                <button id="menuCloseBtn" class="menu-close-btn">âœ•</button>
            </div>
            <div class="menu-items">
                <button id="dailyPuzzleBtn" class="menu-item menu-item-highlight">
                    <span class="menu-item-label">ðŸ“… Daily Puzzle</span>
                </button>
                <div class="menu-divider"></div>
                <button id="briefingBtn" class="menu-item">
                    <span class="menu-item-label">Briefing</span>
                </button>
                <button id="statsBtn" class="menu-item">
                    <span class="menu-item-label">Stats</span>
                </button>
                <div class="menu-divider"></div>
                <button id="tutorialBtn" class="menu-item">
                    <span class="menu-item-label">Play Tutorial</span>
                </button>
                <button id="tutorialCurrentBtn" class="menu-item" style="display: none;">
                    <span class="menu-item-label">Tutorial: Current Puzzle</span>
                </button>
                <div class="menu-divider"></div>

                <!-- Assist Mode Expandable Menu -->
                <div class="menu-expand-section">
                    <button id="assistModeBtn" class="menu-item menu-toggle menu-expand-header">
                        <span class="menu-expand-icon">â–¶</span>
                        <span class="menu-item-label">Assist Mode</span>
                        <span id="assistModeState" class="menu-toggle-state">ON</span>
                    </button>
                    <div id="assistModeContent" class="menu-expand-content">
                        <!-- Visual Hints Sub-section -->
                        <div class="menu-expand-section nested">
                            <button id="visualHintsBtn" class="menu-item menu-toggle menu-expand-header">
                                <span class="menu-expand-icon">â–¶</span>
                                <span class="menu-item-label">Visual Hints</span>
                                <span id="visualHintsState" class="menu-toggle-state">ON</span>
                            </button>
                            <div id="visualHintsContent" class="menu-expand-content">
                                <button id="errorIndicatorsBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Error Indicators</span>
                                    <span id="errorIndicatorsState" class="menu-toggle-state">ON</span>
                                </button>
                                <button id="progressIndicatorsBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Progress Indicators</span>
                                    <span id="progressIndicatorsState" class="menu-toggle-state">ON</span>
                                </button>
                                <button id="hintsEnabledBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Hints Tool</span>
                                    <span id="hintsEnabledState" class="menu-toggle-state off-state">OFF</span>
                                </button>
                                <button id="decryptToggleBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Display Solution</span>
                                    <span id="decryptToggleState" class="menu-toggle-state off-state">OFF</span>
                                </button>
                            </div>
                        </div>
                        <!-- Auto-fill Sub-section -->
                        <div id="autoFillSection" class="menu-expand-section nested">
                            <button id="autoFillBtn" class="menu-item menu-toggle menu-expand-header">
                                <span class="menu-expand-icon">â–¶</span>
                                <span class="menu-item-label">Auto-fill</span>
                                <span id="autoFillState" class="menu-toggle-state">ON</span>
                            </button>
                            <div id="autoFillContent" class="menu-expand-content">
                                <button id="deadEndFillBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Dead-end Fill</span>
                                    <span id="deadEndFillState" class="menu-toggle-state">ON</span>
                                </button>
                                <button id="wallCompletionBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Wall Completion</span>
                                    <span id="wallCompletionState" class="menu-toggle-state">ON</span>
                                </button>
                                <button id="pathCompletionBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Path Completion</span>
                                    <span id="pathCompletionState" class="menu-toggle-state">ON</span>
                                </button>
                                <button id="applyHintsBtn" class="menu-item menu-toggle nested-item">
                                    <span class="menu-item-label">Apply Hints</span>
                                    <span id="applyHintsState" class="menu-toggle-state">ON</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu-footer">
                <div id="seedDivider" class="menu-divider"></div>
                <!-- Seed Section -->
                <div id="seedSection" class="seed-section">
                    <div class="seed-current">
                        <span class="seed-label">Seed:</span>
                        <span id="currentSeed" class="seed-value">------</span>
                        <button id="copySeedBtn" class="seed-copy-btn" title="Copy seed">ðŸ“‹</button>
                    </div>
                    <div class="seed-history">
                        <span class="seed-label">Recent:</span>
                        <div id="seedHistory" class="seed-history-list"></div>
                    </div>
                    <div class="seed-input-row">
                        <input type="text" id="seedInput" class="seed-input" placeholder="Enter seed..." maxlength="12">
                        <button id="playSeedBtn" class="seed-play-btn">Play</button>
                    </div>
                </div>
                <div class="menu-divider"></div>
                <button id="resetAllDataBtn" class="menu-item menu-item-danger">
                    <span class="menu-item-label">Reset All Data</span>
                </button>
                <div class="menu-divider"></div>
                <div class="menu-audio-row">
                    <button id="soundToggleBtn" class="menu-audio-btn" title="Sound Effects">
                        <span id="soundIcon">ðŸ”Š</span>
                    </button>
                    <button id="musicToggleBtn" class="menu-audio-btn" title="Music">
                        <span id="musicIcon">ðŸŽµ</span>
                    </button>
                </div>
                <div class="menu-version">v1.2.0</div>
            </div>
        </div>
    </div>

    <div class="mode-strip">
        <button id="modeWall" class="mode-btn" data-mode="wall">
            <span class="mode-icon mode-icon-wall"></span>
            <span>Wall</span>
        </button>
        <button id="modePath" class="mode-btn" data-mode="path">
            <span class="mode-icon mode-icon-path"></span>
            <span>Path</span>
        </button>
        <button id="modeErase" class="mode-btn" data-mode="erase">
            <span class="mode-icon mode-icon-erase"></span>
            <span>Erase</span>
        </button>
        <button id="modeSmart" class="mode-btn active" data-mode="smart">
            <span class="mode-icon mode-icon-wall"></span>
            <span class="mode-icon mode-icon-path"></span>
            <span class="mode-icon mode-icon-erase"></span>
            <span>Auto</span>
        </button>
        <button id="modeHint" class="mode-btn" data-mode="hint">
            <span class="mode-icon mode-icon-hint"></span>
            <span>Hint</span>
        </button>
    </div>

    <div class="grid-wrapper">
        <div></div><div id="colLabels" class="label-container-col"></div><div></div>
        <div id="rowLabels" class="label-container-row"></div>
        <div id="mainGrid" class="cyber-grid">
            <div id="victoryOverlay">
                <div class="scan-lines"></div>
                <div class="victory-content">
                    <div class="victory-title">NEURAL LINK RESTORED</div>
                    <div id="technoBabble" class="techno-babble"></div>
                    <div class="victory-stats">
                        <div class="stat-row">
                            <span class="stat-label">Sync Duration:</span>
                            <span id="statTime" class="stat-value">00:00</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Node Operations:</span>
                            <span id="statMoves" class="stat-value">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Consecutive Links:</span>
                            <span id="statStreak" class="stat-value">1</span>
                        </div>
                    </div>
                    <button id="nextLevelBtn" class="cyber-btn btn-action next-level-btn">Initialize Next Sequence</button>
                </div>
            </div>
        </div>
        <div class="grid-spacer"></div>
    </div>

    <!-- Hint Toast (Android-style bottom toast) -->
    <div class="below-board-area">
        <div id="hintToast" class="hint-toast">
            <div class="hint-toast-content">
                <span id="hintMessage" class="hint-toast-message"></span>
            </div>
        </div>
    </div>

    <!-- Stats Dialog -->
    <div id="statsOverlay" class="stats-overlay">
        <div class="stats-modal">
            <div class="stats-title">OPERATOR METRICS</div>
            <div class="stats-content">
                <div class="stat-row">
                    <span class="stat-label">Total Puzzles Solved:</span>
                    <span id="statTotalWins" class="stat-value">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Time Played:</span>
                    <span id="statTotalTime" class="stat-value">00:00:00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Moves:</span>
                    <span id="statTotalMoves" class="stat-value">0</span>
                </div>
                <div class="stats-section-title">By Grid Size</div>
                <div class="stats-size-tabs">
                    <button class="stats-tab active" data-size="4">4Ã—4</button>
                    <button class="stats-tab" data-size="5">5Ã—5</button>
                    <button class="stats-tab" data-size="6">6Ã—6</button>
                    <button class="stats-tab" data-size="7">7Ã—7</button>
                    <button class="stats-tab" data-size="8">8Ã—8</button>
                </div>
                <div id="statsSizeContent" class="stats-size-content">
                    <div class="stat-row">
                        <span class="stat-label">Puzzles Solved:</span>
                        <span id="statSizeWins" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Best Streak:</span>
                        <span id="statSizeStreak" class="stat-value">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Fastest Time:</span>
                        <span id="statSizeFastest" class="stat-value">--:--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Fewest Moves:</span>
                        <span id="statSizeMoves" class="stat-value">--</span>
                    </div>
                </div>
            </div>
            <div class="stats-buttons">
                <button id="statsCloseBtn" class="cyber-btn">Dismiss</button>
                <button id="statsClearBtn" class="cyber-btn btn-kill">Clear Stats</button>
            </div>
        </div>
    </div>

    <!-- Clear Stats Confirm Dialog -->
    <dialog id="clearStatsDialog" class="confirm-dialog">
        <div class="confirm-dialog-content">
            <div class="confirm-dialog-title">CONFIRM DATA PURGE</div>
            <p class="confirm-dialog-message">Clear all operator metrics? This action cannot be undone.</p>
            <div class="confirm-dialog-buttons">
                <button id="clearStatsCancelBtn" class="cyber-btn">Cancel</button>
                <button id="clearStatsConfirmBtn" class="cyber-btn btn-kill">Clear Stats</button>
            </div>
        </div>
    </dialog>

    <!-- Reset All Data Confirm Dialog -->
    <dialog id="resetAllDataDialog" class="confirm-dialog">
        <div class="confirm-dialog-content">
            <div class="confirm-dialog-title">âš  FULL SYSTEM RESET âš </div>
            <p class="confirm-dialog-message">This will erase ALL data: stats, progress, unlocked levels, and tutorial completion. You will start fresh as a new operator. This cannot be undone.</p>
            <div class="confirm-dialog-buttons">
                <button id="resetAllCancelBtn" class="cyber-btn">Cancel</button>
                <button id="resetAllConfirmBtn" class="cyber-btn btn-kill">Reset Everything</button>
            </div>
        </div>
    </dialog>

    <!-- Reset Puzzle Confirm Dialog -->
    <dialog id="resetPuzzleDialog" class="confirm-dialog">
        <div class="confirm-dialog-content">
            <div class="confirm-dialog-title">CONFIRM INITIALIZATION</div>
            <p class="confirm-dialog-message">Discard progress and start a new puzzle?</p>
            <div class="confirm-dialog-buttons">
                <button id="resetPuzzleCancelBtn" class="cyber-btn">Cancel</button>
                <button id="resetPuzzleConfirmBtn" class="cyber-btn btn-kill">Initialize</button>
            </div>
        </div>
    </dialog>

    <!-- Tutorial Intro Dialog -->
    <dialog id="tutorialIntroDialog" class="tutorial-dialog">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">TRAINING PROTOCOL INITIATED</div>
            <div class="tutorial-dialog-body">
                <p>Welcome, Operator. This guided training will teach you to decode neural pathways.</p>
                <div class="tutorial-rules">
                    <p><span class="tutorial-highlight">OBJECTIVE:</span> Find the hidden path by placing walls<span class="cell-icon cell-icon-wall"></span>.</p>
                    <p><span class="tutorial-highlight">RULE 1:</span> Numbers show how many walls belong in each row/column.</p>
                    <p><span class="tutorial-highlight">RULE 2:</span> All path cells must connect to form one continuous network.</p>
                    <p><span class="tutorial-highlight">RULE 3:</span> No dead ends except at <span class="cell-icon cell-icon-deadend"></span> nodes.</p>
                    <p><span class="tutorial-highlight">RULE 4:</span> No 2Ã—2 blocks of path cells allowed.</p>
                </div>
                <p class="tutorial-instruction">Follow the hints to complete the puzzle.</p>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="tutorialIntroStartBtn" class="cyber-btn btn-action">Begin Training</button>
            </div>
        </div>
    </dialog>

    <!-- Tutorial Complete Dialog -->
    <dialog id="tutorialCompleteDialog" class="tutorial-dialog tutorial-complete">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">TRAINING COMPLETE</div>
            <div class="tutorial-dialog-body">
                <p class="tutorial-success">Neural pathway reconstruction successful!</p>
                <p class="tutorial-techno">Synaptic calibration verified. Cognitive pattern recognition modules now online. You are cleared for field operations.</p>
                <p class="tutorial-next">Complete more puzzles to unlock larger grid sizes with greater challenges.</p>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="tutorialCompleteBtn" class="cyber-btn btn-action">Continue</button>
            </div>
        </div>
    </dialog>

    <!-- User Tutorial Complete Dialog (simpler version) -->
    <dialog id="userTutorialCompleteDialog" class="tutorial-dialog tutorial-complete">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">TRAINING COMPLETE</div>
            <div class="tutorial-dialog-body">
                <p class="tutorial-success">Neural pathway reconstruction successful!</p>
                <p class="tutorial-techno">Pattern analysis complete. All logical deductions verified.</p>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="userTutorialCompleteBtn" class="cyber-btn btn-action">Continue</button>
            </div>
        </div>
    </dialog>

    <!-- Level Unlocked Dialog -->
    <dialog id="levelUnlockedDialog" class="tutorial-dialog tutorial-complete">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">CLEARANCE UPGRADED</div>
            <div class="tutorial-dialog-body">
                <p class="tutorial-success">Neural bandwidth expanded!</p>
                <p class="tutorial-techno" id="unlockTechnoText">Cognitive load capacity verified. Higher-complexity matrices now accessible.</p>
                <p class="tutorial-next" id="unlockNextText">You've unlocked <span class="tutorial-highlight" id="unlockedSizeText">5Ã—5</span> grids. Ready to increase the challenge? You can always return to smaller grids anytime.</p>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="stayCurrentSizeBtn" class="cyber-btn">Not Yet</button>
                <button id="tryNewSizeBtn" class="cyber-btn btn-action">Next Challenge</button>
            </div>
        </div>
    </dialog>

    <!-- Data Vault Intro Dialog -->
    <dialog id="dataVaultIntroDialog" class="tutorial-dialog">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">NEW ELEMENT DETECTED</div>
            <div class="tutorial-dialog-body">
                <p>This grid contains a <span class="tutorial-highlight theme-vault">Data Vault</span> â€” a secure 3Ã—3 zone surrounding a <span class="theme-stockpile">Data Cache</span>.</p>
                <div class="tutorial-rules">
                    <p><span class="tutorial-highlight"><span class="tutorial-highlight theme-vault">Data Vault</span> Rules:</span></p>
                    <p>â€¢ The <span class="theme-vault">Data Vault</span> is a 3Ã—3 area of path cells. A <span class="theme-stockpile">Data Cache</span> is located somewhere inside the vault, but the exact location is not known.</p>
                    <p>â€¢ The <span class="theme-vault">Data Vault</span> must be surrounded by walls on all sides</p>
                    <p>â€¢ Exactly ONE doorway connects the <span class="theme-vault">Data Vault</span> to the main path</p>
                    <p>â€¢ The 2Ã—2 rule does NOT apply inside the <span class="theme-vault">Data Vault</span></p>
                </div>
                <p class="tutorial-instruction">Would you like guided training for this puzzle?</p>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="dataVaultSkipBtn" class="cyber-btn">Skip Tutorial</button>
                <button id="dataVaultTutorialBtn" class="cyber-btn btn-action">Start Tutorial</button>
            </div>
        </div>
    </dialog>

    <!-- Auto Tool Explanation Dialog -->
    <dialog id="autoToolDialog" class="tutorial-dialog">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">AUTO TOOL</div>
            <div class="tutorial-dialog-body" id="autoToolDialogBody">
                <p>The <span class="tutorial-highlight">Auto</span> tool is context-aware and adapts to what you tap on.</p>
                
                <div class="auto-tool-sections">
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">TAPPING & DRAGGING:</span></p>
                        <div class="tutorial-rules">
                            
                            <div class="auto-tool-example">
                                <div class="auto-tool-diagram">
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>                                    </div>
                                    <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                    </div>
                                </div>
                                <p>Tap on an empty cell and start dragging to place <span class="theme-walls">walls</span> in other empty cells.</p>
                            </div>

                            <div class="auto-tool-example">
                                <div class="auto-tool-diagram">
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-wall"></div>
                                        <div class="tip-cell tip-cell-wall"></div>
                                    </div>
                                    <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                    </div>
                                </div>
                                <p>Tap on a wall and start dragging to change <span class="theme-walls">walls</span> into <span class="theme-paths">paths</span>.</p>
                            </div>

                            <div class="auto-tool-example">
                                <div class="auto-tool-diagram">
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                    </div>
                                    <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                </div>
                                <p>Tap on a <span class="theme-path">path</span> and start dragging on paths to erase the <span class="theme-path">path</span>.</p>
                            </div>


                            <div class="auto-tool-example">
                                <div class="auto-tool-diagram">
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                    <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-path"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                    </div>
                                </div>
                                <p>Tap on a <span class="theme-path">path</span> and start dragging on empty cells to place more <span class="theme-paths">paths</span>.</p>
                            </div>

                            <div class="auto-tool-example">
                                <div class="auto-tool-diagram">
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-deadend"></div>
                                        <div class="tip-cell"></div>
                                    </div>
                                    <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                                    <div class="tip-grid" style="grid-template-columns: repeat(2, 32px); gap: 8px;">
                                        <div class="tip-cell tip-cell-deadend"></div>
                                        <div class="tip-cell tip-cell-path"></div>
                                    </div>
                                </div>
                                <p>Tap on a <span class="theme-deadend">dead end</span> and start dragging to place <span class="theme-paths">paths</span>.</p>
                            </div>
                        </div>
                    </div>
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">TAPPING:</span></p>
                        <div class="tutorial-rules">
                    <div class="auto-tool-example">
                        <div class="auto-tool-diagram">
                            <div style="text-align: center;">
                                <div style="display: inline-block; padding: 4px 8px; background: linear-gradient(135deg, rgba(0, 255, 159, 0.2), rgba(0, 255, 159, 0.1)); border: 1px solid var(--neon-green); border-radius: 4px; margin-bottom: 4px;">
                                    <span style="color: var(--neon-green); font-weight: bold;">3</span>
                                </div>
                                <div class="tip-grid" style="grid-template-columns: repeat(1, 32px); gap: 2px; margin: 4px auto;">
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell"></div>
                                    <div class="tip-cell"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                </div>
                            </div>
                            <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                            <div style="text-align: center;">
                                <div style="display: inline-block; padding: 4px 8px; background: linear-gradient(135deg, rgba(0, 255, 159, 0.2), rgba(0, 255, 159, 0.1)); border: 1px solid var(--neon-green); border-radius: 4px; margin-bottom: 4px;">
                                    <span style="color: var(--neon-green); font-weight: bold;">3</span>
                                </div>
                                <div class="tip-grid" style="grid-template-columns: repeat(1, 32px); gap: 2px; margin: 4px auto;">
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                    <div class="tip-cell tip-cell-path"></div>
                                    <div class="tip-cell tip-cell-path"></div>
                                    <div class="tip-cell tip-cell-wall"></div>
                                </div>
                            </div>
                        </div>
                        <p>Tap a green row/column header to fill all empty cells with <span class="theme-paths">paths</span>.</p>
                    </div>

                    <div class="auto-tool-example">
                        <div class="auto-tool-diagram">
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 32px); gap: 4px;">
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                            </div>
                            <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 32px); gap: 4px;">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <p>Tap a <span class="theme-deadend">dead end</span> with one <span class="theme-path">path</span> to fill in the surrounding empty cells with <span class="theme-walls">walls</span>.</p>
                    </div>

                    <div class="auto-tool-example">
                        <div class="auto-tool-diagram">
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 32px); gap: 4px;">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                            <div style="margin: 0 8px; font-size: 20px;">â†’</div>
                            <div class="tip-grid" style="grid-template-columns: repeat(3, 32px); gap: 4px;">
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-path"></div>
                                <div class="tip-cell tip-cell-deadend"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                                <div class="tip-cell tip-cell-wall"></div>
                                <div class="tip-cell"></div>
                            </div>
                        </div>
                        <p>Tap a <span class="theme-deadend">dead end</span> with three <span class="theme-walls">walls</span> to place the required <span class="theme-path">path</span>.</p>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="autoToolGotItBtn" class="cyber-btn btn-action">Got It</button>
            </div>
        </div>
    </dialog>

    <!-- Fork Explanation Dialog -->
    <dialog id="forkDialog" class="tutorial-dialog">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">FORK</div>
            <div class="tutorial-dialog-body" id="forkDialogBody">
                <p>The <span class="tutorial-highlight theme-fork">Fork</span> feature lets you create a new layer to experiment with guesses.</p>
                
                <div class="auto-tool-sections">
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">HOW IT WORKS:</span></p>
                        <div class="tutorial-rules">
                            <p>â€¢ Tap <span class="briefing-tag theme-fork">Fork</span> to create a new experimental layer</p>
                            <p>â€¢ You can create multiple levels of forks (up to 3)</p>
                            <p>â€¢ Make guesses and see if they lead to contradictions</p>
                            <p>â€¢ Use <span class="briefing-tag theme-commit">Commit</span> to merge your changes into the previous layer</p>
                            <p>â€¢ Use <span class="briefing-tag theme-discard">Discard</span> to undo the fork and return to the previous layer</p>
                        </div>
                    </div>
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">WHEN TO USE:</span></p>
                        <div class="tutorial-rules">
                            <p>â€¢ When you're stuck and need to make an educated guess</p>
                            <p>â€¢ To test if a cell should be a wall or path</p>
                            <p>â€¢ If your guess leads to a contradiction, discard and try the opposite</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="forkGotItBtn" class="cyber-btn btn-action">Got It</button>
            </div>
        </div>
    </dialog>

    <!-- Hint Explanation Dialog -->
    <dialog id="hintDialog" class="tutorial-dialog">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">HINT TOOL</div>
            <div class="tutorial-dialog-body" id="hintDialogBody">
                <p>The <span class="tutorial-highlight">Hint</span> tool lets you get hints for specific cells by tapping them.</p>
                
                <div class="auto-tool-sections">
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">HOW IT WORKS:</span></p>
                        <div class="tutorial-rules">
                            <p>â€¢ Tap any empty cell to get a hint for that cell</p>
                            <p>â€¢ The hint will show a message and highlight relevant cells</p>
                            <p>â€¢ The hint explain how to determine whether the cell should be a <span class="theme-wall">wall</span> or a <span class="theme-paths">path</span></p>
                        </div>
                    </div>
                    <div class="auto-tool-section">
                        <p><span class="tutorial-highlight">TIPS:</span></p>
                        <div class="tutorial-rules">
                            <p>â€¢ You can also use the <span class="tutorial-highlight">?</span> button to get the next available hint</p>
                            <p>â€¢ If "Apply Hints" is enabled, the <span class="tutorial-highlight">?</span> button will automatically fill in the suggested cells.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tutorial-dialog-buttons">
                <button id="hintGotItBtn" class="cyber-btn btn-action">Got It</button>
            </div>
        </div>
    </dialog>

    <!-- Daily Puzzle Complete Dialog -->
    <dialog id="dailyCompleteDialog" class="tutorial-dialog tutorial-complete">
        <div class="tutorial-dialog-content">
            <div class="tutorial-dialog-title">ðŸ“… DAILY PUZZLE COMPLETE</div>
            <div class="tutorial-dialog-body">
                <p class="tutorial-success">Today's neural pathway secured!</p>
                <div class="daily-complete-stats">
                    <div class="stat-row">
                        <span class="stat-label">Date:</span>
                        <span id="dailyCompleteDate" class="stat-value">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Time:</span>
                        <span id="dailyCompleteTime" class="stat-value">--:--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Moves:</span>
                        <span id="dailyCompleteMoves" class="stat-value">--</span>
                    </div>
                </div>
                <p class="tutorial-techno">Daily encryption sequence verified.<br>Return tomorrow for the next challenge.</p>
            </div>
            <div class="tutorial-dialog-buttons daily-complete-buttons">
                <button id="dailyShareBtn" class="cyber-btn btn-share">Share</button>
                <button id="dailyCompleteBtn" class="cyber-btn btn-action">Continue</button>
            </div>
        </div>
    </dialog>

    <!-- Theme System -->
    <script src="themes/theme-base.js"></script>
    <script src="themes/theme-manager.js"></script>
    <script src="themes/theme-cyberpunk.js"></script>

    <script src="game.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Register service worker with explicit scope to work at any path depth
                const scope = './';
                navigator.serviceWorker.register('./service-worker.js', { scope: scope })
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>

